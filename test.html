<!DOCTYPE html>
<html>
  <head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155991615-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "UA-155991615-1");
    </script>

    <!-- metaphysics -->
    <meta charset="utf-8">
    <title>Iframe parent testing</title>
    <meta name="author" content="Markus Mannheim">
    <meta name="keywords" content="iframe, parent, window, testing, dark, light, background, color, mode">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- scripts -->
    <script src="./resources/d3.v7.min.js"></script>
    <link href="./resources/test.css" rel="stylesheet">
  </head>

  <body>
    <div id="container"></div>

    <script>

        function detectParentPageBackgroundColor() {
        var targetElement = document.getElementById('container'); // Replace with the ID of the representative <div> element

        targetElement.addEventListener('click', function(event) {
            var pixelColor = getPixelColor(event.clientX, event.clientY);
            console.log('Parent page background color:', pixelColor);
        });

        function getPixelColor(x, y) {
            var parentWindow = window.parent;
            var pixelData;
            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');

            canvas.width = 1;
            canvas.height = 1;

            // Simulate a click event at the specified coordinates
            var clickEvent = new MouseEvent('click', {
            clientX: x,
            clientY: y,
            });
            parentWindow.document.dispatchEvent(clickEvent);

            // Draw the clicked pixel onto the canvas
            context.drawImage(parentWindow.document.documentElement, x, y, 1, 1, 0, 0, 1, 1);

            // Get the pixel data
            pixelData = context.getImageData(0, 0, 1, 1).data;

            return 'rgb(' + pixelData[0] + ', ' + pixelData[1] + ', ' + pixelData[2] + ')';
        }
        }

        // Call the function when the iframe has finished loading
        window.addEventListener('load', detectParentPageBackgroundColor);


    </script>
  </body>
</html>